<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reporting | Dashboard</title>
    <script src="./auth.js"></script>
    <noscript>
      <meta http-equiv="refresh" content="100; URL=/login.html" />
    </noscript>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        font-family: Arial, Helvetica, sans-serif;
      }
      html {
        width: 100%;
        height: 100vh;
      }
      body {
        width: 100%;
        height: 100%;
        padding: 1rem;
        display: flex;
        flex-direction: column;
      }
      #logout {
        background-color: transparent;
        border: 0 none;
        text-decoration: underline;
        cursor: pointer;
        padding: 0;
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 11pt;
      }

      #usermgmt {
        background-color: transparent;
        border: 0 none;
        text-decoration: underline;
        cursor: pointer;
        padding: 0;
        position: absolute;
        bottom: 1rem;
        right: 1rem;
      }

      a {
        text-decoration: none;
        text-decoration: underline;
        color: black;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 11pt;
      }

      #fast-data {
        width: 100%;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
      }

      #fast-data > p {
        font-size: 35pt;
        font-weight: black;
        font-family: Arial, Helvetica, sans-serif;
        height: 5rem;
      }

      #title {
        width: 100%;
        text-align: left;
      }
    </style>
  </head>

  <body>
    <button id="logout">Log Out</button>
    <h1 id="title">Reporting Dashboard</h1>
    <a href="./users.html" id="usermgmt" style="display: none"
      >User Management</a
    >
    <div id="fast-data"></div>
  </body>
  <script>
    let btn = document.getElementById("logout");
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      sessionStorage.clear();
      window.location.replace("https://reporting.josh-cse135.site/login.html");
    });
    var day_range = 2;
    var dash_data = null;
    let fastData = document.getElementById("fast-data");
    fetch(
      `https://reporting.josh-cse135.site/api/dash?day_range=${day_range}`,
      {
        method: "GET",
      }
    ).then((res) =>
      res.json().then((json_res) => {
        dash_data = json_res[0];
        let sessionCnt = document.createElement("p");
        sessionCnt.innerHTML = "Session Count" + dash_data["sessions"];
        fastData.appendChild(sessionCnt);
        let avgLoad = document.createElement("p");
        avgLoad.innerHTML = "Average Load Time (ms)" + dash_data["avg_load"];
        fastData.appendChild(avgLoad);
      })
    );
  </script>
</html>
